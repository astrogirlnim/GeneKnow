---
config:
  layout: fixed
---
flowchart TD
 subgraph subGraph0["Phase 1: Offline Model Training & Validation (Done Before App is Shipped)"]
        B_Train("Model Training<br>TensorFlow/PyTorch")
        A_Data["Public &amp; Clinical Data<br>TCGA, 1000 Genomes"]
        C_Eval{"Evaluate Performance
            ---
            **AUC-ROC:** Measures ability to distinguish high vs. low risk.
            **Sensitivity/F1-Score:** Prioritized to minimize false negatives (clinical safety).
            **MCC:** Provides a robust, balanced score for overall performance."}
        D_Artifact(("Validated Model Artifact<br>*.pt / *.h5 file"))
  end
 subgraph subGraph1["Data Ingestion & Processing"]
        G_Cond{"Conditional"}
        F_Parse["Alignment/Parsing"]
        E_Input["File Input<br>FASTQ/BAM/VCF"]
        H_Call["Variant Calling<br>DeepVariant"]
        I_QC["QC Filter"]
        J_Merge["Merge & Consolidate"]
  end
 subgraph subGraph2["Genomic Feature Extraction"]
        K_Pop["Population Mapper<br>gnomAD/dbSNP"]
        L_TCGA["TCGA Mapper"]
        M_CADD["CADD Scoring"]
        N_ClinVar["ClinVar Annotator"]
        O_PRS["PRS Calculator"]
        P_Pathway["Pathway Burden"]
  end
 subgraph subGraph3["Machine Learning & Validation"]
        Q_Vec["Feature Vector Builder"]
        R_Model("Risk Model<br>TensorFlow/PyTorch")
        S_Sanity{{"Explainability &amp; Sanity-Check<br>SHAP-based rules"}}
  end
 subgraph subGraph4["Report & Human Interaction"]
        T_Format["Formatter &amp; Report Writer<br>Generate Markdown/VCF with PASS/FLAG"]
        U_Front(["Frontend<br>React + Tailwind"])
        V_Verify{"Human Verification"}
        W_KM_Viz["Kaplan-Meier<br>Survival Curve Viz 📊"]
        V_Confirm["Simple Confirmation<br>👍 / 👎"]
        V_Review["Manual Review Required"]
  end
 subgraph subGraph5["Phase 2: Online Real-Time Inference Pipeline (Runs in the App)"]
        subGraph1
        subGraph2
        subGraph3
        subGraph4
  end
    A_Data --> B_Train
    B_Train --> C_Eval
    C_Eval --> D_Artifact
    E_Input --> F_Parse
    F_Parse --> G_Cond
    G_Cond --> H_Call & I_QC
    H_Call --> J_Merge
    I_QC --> J_Merge
    J_Merge --> K_Pop
    K_Pop --> L_TCGA & M_CADD & N_ClinVar & O_PRS & P_Pathway
    L_TCGA --> Q_Vec
    M_CADD --> Q_Vec
    N_ClinVar --> Q_Vec
    O_PRS --> Q_Vec
    P_Pathway --> Q_Vec
    Q_Vec --> R_Model
    R_Model --> S_Sanity
    D_Artifact -- "Is Loaded By..." --> R_Model
    S_Sanity --> T_Format
    T_Format --> U_Front
    U_Front --> V_Verify & W_KM_Viz
    V_Verify -- ✅ PASS Status --> V_Confirm
    V_Verify -- ⚠️ FLAG Status --> V_Review
    style A_Data fill:#cde4f7,stroke:#333
    style B_Train fill:#e2d9f3,stroke:#333
    style C_Eval fill:#fce8b2,stroke:#333
    style D_Artifact fill:#d4edda,stroke:#333,stroke-width:4px
    style E_Input fill:#cde4f7,stroke:#333
    style F_Parse fill:#cde4f7,stroke:#333
    style G_Cond fill:#cde4f7,stroke:#333
    style H_Call fill:#cde4f7,stroke:#333
    style I_QC fill:#cde4f7,stroke:#333
    style J_Merge fill:#cde4f7,stroke:#333
    style K_Pop fill:#d4edda,stroke:#333
    style L_TCGA fill:#d4edda,stroke:#333
    style M_CADD fill:#d4edda,stroke:#333
    style N_ClinVar fill:#d4edda,stroke:#333
    style O_PRS fill:#d4edda,stroke:#333
    style P_Pathway fill:#d4edda,stroke:#333
    style Q_Vec fill:#e2d9f3,stroke:#333
    style R_Model fill:#e2d9f3,stroke:#333
    style S_Sanity fill:#fce8b2,stroke:#d63384,stroke-width:3px
    style T_Format fill:#d1ecf1,stroke:#333
    style U_Front fill:#f8d7da,stroke:#333
    style V_Verify fill:#f8d7da,stroke:#333
    style W_KM_Viz fill:#d1ecf1,stroke:#333
    style V_Confirm fill:#d4edda,stroke:#333
    style V_Review fill:#fce8b2,stroke:#333 